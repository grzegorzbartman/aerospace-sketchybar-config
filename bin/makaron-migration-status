#!/bin/bash

# Show migration status
# Lists all migrations and their status (completed, pending, skipped)

STATE_DIR="$HOME/.local/state/makaron/migrations"
MIGRATIONS_DIR="$HOME/.local/share/makaron/migrations"

echo "Makaron Migration Status"
echo "========================"

if [[ ! -d "$MIGRATIONS_DIR" ]]; then
    echo "No migrations directory found"
    exit 0
fi

echo "Migration files:"
for file in "$MIGRATIONS_DIR"/*.sh; do
  if [[ -f "$file" ]]; then
    filename=$(basename "$file")
    migration_name="${filename%.sh}"

    if [[ -f "$STATE_DIR/$filename" ]]; then
        echo "  ✅ $migration_name (completed)"
    elif [[ -f "$STATE_DIR/skipped/$filename" ]]; then
        echo "  ⏭️  $migration_name (skipped)"
    else
        echo "  ⏳ $migration_name (pending)"
    fi
  fi
done

echo ""
echo "State directory: $STATE_DIR"
echo "Migrations directory: $MIGRATIONS_DIR"
